<!--
<html><head>
  <title>esp-rfm69</title>
  <link rel="stylesheet" href="/pure.css">
  <link rel="stylesheet" href="/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="/ui.js"></script>
</head>
<body>
<div id="layout">
 -->

<div id="main">
    <div class="header">
      <h1>Debug Log</h1>
    </div>
    <div class="content">
      <div class="pure-g">
        <div class="pure-u-1-2">
          <a id="refresh-button" class="pure-button button-primary" href="#">Reconnect</a>
        </div>
        <div class="pure-u-1-2">
         <label for="status" style="display: inline;">Socket Status: </label>
         <pre id="status" style="display: inline;"></pre>
       </div>
      </div>
      <pre id="console" class="console" style="margin-top: 0px;height: 600px;"></pre>
    </div>
  </div>
</div>

<!-- <script src="console.js"></script> -->
<script type="text/javascript">
   var wsUri;

   var stateStr = ['DISCONNECTED', 'CONNECTED', '', 'ERROR:', 'SENT:'];
   var stateColor = ['red', 'green', 'blue', 'red', 'blue'];

   onLoad(function () {
      wsUri = "ws://"+window.location.host+"/ws/logws.cgi";
      updateStatus(0);
   });

   function init()
   {
      testWebSocket();
   }

   function testWebSocket()
   {
      websocket = new WebSocket(wsUri);
      websocket.onopen = function(evt) { onOpen(evt) };
      websocket.onclose = function(evt) { onClose(evt) };
      websocket.onmessage = function(evt) { onMessage(evt) };
      websocket.onerror = function(evt) { onError(evt) };
   }

   function onOpen(evt)
   {
      updateStatus(1);
   }

   function onClose(evt)
   {
      updateStatus(0);
   }

   function onMessage(evt)
   {
      writeToScreen(2, evt.data);
      var test = evt.data.length;
      websocket.send(test);
   }

   function onError(evt)
   {
      writeToScreen(3,evt.data);
   }

   function doSend(message)
   {
      writeToScreen(4, message);
      websocket.send(message);
   }

   function updateStatus(num)
   {
      var st = $("#status");
      msg = '<span style="color: '+stateColor[num]+';">'+stateStr[num]+'</span>';
      st.innerHTML = msg;
   }

   function writeToScreen(num, evt_data)
   {
      var output = $("#console");
      var pre = document.createElement("p");
      pre.style.wordWrap = "break-word";
      msg = '<span style="color: '+stateColor[num]+';">'+stateStr[num]+evt_data+'</span>';
      pre.innerHTML = msg;
      output.innerHTML = output.innerHTML.concat(pre.innerHTML);
   }

   $("#refresh-button").addEventListener("click", function(e) {
      e.preventDefault();
      init();
   });

</script>
</body>
</html>
